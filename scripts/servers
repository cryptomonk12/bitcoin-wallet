#!/usr/bin/env python3

from electrum import set_verbosity
from electrum.network import filter_protocol
from collections import defaultdict

import util, json
set_verbosity(False)


servers = util.get_peers()
results = util.send_request(servers, 'blockchain.headers.subscribe', [])

d = defaultdict(int)

for k, r in results.items():
    blocks = r.get('block_height')
    d[blocks] += 1

for k, v in results.items():
    print(k, v.get('block_height'))

v = list(d.values())
k = list(d.keys())
numblocks = k[v.index(max(v))]
print("blocks:", numblocks)
